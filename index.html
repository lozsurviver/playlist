<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>YouTube Playlist Shuffler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
      color: #555;
    }
  </style>
</head>
<body>

  <h1>YouTube Playlist Shuffler</h1>

  <p>Paste a YouTube playlist link below:</p>

  <input
    id="playlistInput"
    type="text"
    placeholder="https://www.youtube.com/playlist?list=..."
  >

  <button onclick="handleShuffle()">Shuffle Playlist</button>

  <div id="status"></div>

<script>
  const apiKey = "AIzaSyCQF4Xz6SGtuvv4PyiuNxZ0LvgEeZ4A_lc"; // replace with your API key
  function extractPlaylistId(url) {
    try {
      const parsedUrl = new URL(url);
      return parsedUrl.searchParams.get("list");
    } catch {
      return null;
    }
  }
  async function fetchPlaylistVideos(playlistId) {
  let videos = [];
  let nextPageToken = "";

  do {
    const response = await fetch(
      `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&pageToken=${nextPageToken}&key=${apiKey}`
    );
    const data = await response.json();
    
    if (!data.items) break;

    videos.push(...data.items.map(item => item.snippet.resourceId.videoId));
    nextPageToken = data.nextPageToken || "";
  } while (nextPageToken);

  return videos;
}// Your default playlists
const defaultPlaylists = [
  "PLAYLIST_ID_1",
  "PLAYLIST_ID_2",
  "PLAYLIST_ID_3"
];

// Automatically set the input field to the first playlist by default
window.addEventListener("load", () => {
  if (defaultPlaylists.length > 0) {
    document.getElementById("playlistInput").value = `https://www.youtube.com/playlist?list=${defaultPlaylists[0]}`;
  }
});

async function handleShuffle() {
  const status = document.getElementById("status");
  status.textContent = "Fetching videos... ⏳";

  try {
    // Fetch videos from all default playlists
    let allVideos = [];
    for (const playlistId of defaultPlaylists) {
      const videos = await fetchPlaylistVideos(playlistId);
      allVideos.push(...videos);
    }

    if (allVideos.length === 0) {
      status.textContent = "No videos found in the playlists.";
      return;
    }

    // Pick a random video from all playlists
    const randomVideo = allVideos[Math.floor(Math.random() * allVideos.length)];

    // Embed the video
    status.innerHTML = `
      <iframe width="560" height="315"
        src="https://www.youtube.com/embed/${randomVideo}?autoplay=1"
        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
      </iframe>
    `;
  } catch (err) {
    console.error(err);
    status.textContent = "Error fetching playlist videos. Check your API key and playlist URLs.";
  }
}

  const playlistId = extractPlaylistId(input);
  if (!playlistId) {
    status.textContent = "Invalid playlist URL. Please try again.";
    return;
  }

  status.textContent = "Fetching videos... ⏳";

  try {
    const videos = await fetchPlaylistVideos(playlistId);

    if (videos.length === 0) {
      status.textContent = "No videos found in this playlist.";
      return;
    }

    // Pick a random video
    const randomVideo = videos[Math.floor(Math.random() * videos.length)];

    // Embed the video
    status.innerHTML = `
      Playlist loaded ✅<br>
      <iframe width="560" height="315"
        src="https://www.youtube.com/embed/${randomVideo}?autoplay=1"
        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
      </iframe>
    `;
  } catch (err) {
    console.error(err);
    status.textContent = "Error fetching playlist videos. Check your API key and playlist URL.";
  }
}
</script>
</body>
</html>
