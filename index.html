<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Playlist Shuffler</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #player-container {
      text-align: center;
      margin: 20px 0;
    }

    #status {
      margin-top: 15px;
      color: #555;
    }

    ul {
      padding: 0;
      margin-top: 20px;
    }

    li {
      list-style: none;
      margin-bottom: 12px;
    }

    a.video-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: #1a73e8;
    }

    a.video-link img {
      width: 120px;
      height: 90px;
      margin-right: 10px;
      object-fit: cover;
    }

    a.video-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<h1>YouTube Playlist Shuffler</h1>

<div style="text-align:center;">
  <button onclick="startShuffle()">Shuffle & Play</button>
  <button onclick="playNextVideo()">Skip Video</button>
</div>

<div id="player-container">
  <div id="player"></div>
</div>

<div id="status">Loading videos...</div>

<ul id="videoList"></ul>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
  let allVideos = [];
  let shuffledVideos = [];
  let currentIndex = 0;
  let player;
  let skipInProgress = false;

  async function loadVideosFromJSON() {
    const response = await fetch("videos.json");
    const data = await response.json();
    allVideos = data.videos;

    document.getElementById("status").textContent =
      `Loaded ${allVideos.length} videos âœ…`;
  }

  function shuffleVideos() {
    shuffledVideos = [...allVideos];
    for (let i = shuffledVideos.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffledVideos[i], shuffledVideos[j]] =
      [shuffledVideos[j], shuffledVideos[i]];
    }
    currentIndex = 0;
  }

  function renderList(count = 10) {
    const list = document.getElementById("videoList");
    list.innerHTML = "";

    for (let i = currentIndex; i < Math.min(currentIndex + count, shuffledVideos.length); i++) {
      const v = shuffledVideos[i];
      const li = document.createElement("li");

      li.innerHTML = `
        <a class="video-link" href="#" onclick="playAtIndex(${i})">
          <img src="${v.thumbnail}" alt="${v.title}">
          <span>${v.title}</span>
        </a>
      `;
      list.appendChild(li);
    }
  }

  function playAtIndex(index) {
    currentIndex = index;
    skipInProgress = false;
    player.loadVideoById(shuffledVideos[currentIndex].id);
    renderList();
  }

  function playNextVideo() {
    currentIndex++;

    if (currentIndex >= shuffledVideos.length) {
      document.getElementById("status").textContent =
        "Playlist finished ðŸŽ‰";
      return;
    }

    skipInProgress = false;
    player.loadVideoById(shuffledVideos[currentIndex].id);
    renderList();
  }

  function startShuffle() {
    shuffleVideos();
    skipInProgress = false;
    player.loadVideoById(shuffledVideos[0].id);
    renderList();
  }

  function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
      height: "405",
      width: "720",
      events: {
        onStateChange: onPlayerStateChange,
        onError: onPlayerError
      }
    });
  }

  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
      playNextVideo();
    }
  }

  function onPlayerError(event) {
    // Prevent infinite error loops
    if (skipInProgress) return;

    skipInProgress = true;
    console.warn("Video unavailable, skippingâ€¦", shuffledVideos[currentIndex].id);
    playNextVideo();
  }

  window.onload = loadVideosFromJSON;
</script>

</body>
</html>
