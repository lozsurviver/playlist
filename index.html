<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Playlist Shuffler</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #121212;
    color: #e0e0e0;
  }

  header {
    text-align: center;
    padding: 16px;
    font-size: 22px;
    font-weight: bold;
    border-bottom: 1px solid #333;
  }

  main {
    display: flex;
    height: calc(100vh - 140px);
  }

  #player-section {
    flex: 2;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  #player {
    width: 100%;
    max-width: 720px;
    aspect-ratio: 16 / 9;
    background: black;
  }

  #list-section {
    flex: 1;
    border-left: 1px solid #333;
    overflow-y: auto;
    padding: 20px;
  }

  .video-item {
    display: flex;
    gap: 10px;
    margin-bottom: 12px;
    cursor: pointer;
    opacity: 0.85;
  }

  .video-item:hover {
    opacity: 1;
  }

  .video-item img {
    width: 120px;
    height: 90px;
    object-fit: cover;
  }

  .video-title {
    font-size: 14px;
  }

  .active {
    outline: 2px solid #1db954;
  }

  footer {
    height: 100px;
    border-top: 1px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
  }

  button {
    background: #1f1f1f;
    border: 1px solid #333;
    color: #e0e0e0;
    padding: 10px 14px;
    font-size: 16px;
    cursor: pointer;
  }

  button:hover {
    background: #2a2a2a;
  }

  input[type="range"] {
    width: 120px;
  }
</style>
</head>

<body>

<header>YouTube Playlist Shuffler</header>

<main>
  <section id="player-section">
    <div id="player"></div>
  </section>

  <section id="list-section"></section>
</main>

<footer>
  üîä
  <input type="range" min="0" max="100" id="volumeSlider">
  <button onclick="playPrevious()">‚èÆ</button>
  <button onclick="togglePlay()">‚èØ</button>
  <button onclick="playNext()">‚è≠</button>
  <button onclick="reshuffle()">üîÄ</button>
</footer>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let allVideos = [];
let shuffledVideos = [];
let currentIndex = 0;
let player;
let isPlaying = true;
let skipInProgress = false;

let globalVolume = parseInt(localStorage.getItem("ytVolume")) || 50;

async function loadVideos() {
  const res = await fetch("videos.json");
  const data = await res.json();
  allVideos = data.videos;
  reshuffle();
}

function reshuffle() {
  shuffledVideos = [...allVideos];
  for (let i = shuffledVideos.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledVideos[i], shuffledVideos[j]] =
    [shuffledVideos[j], shuffledVideos[i]];
  }
  currentIndex = 0;
  loadCurrent();
}

function loadCurrent() {
  player.loadVideoById(shuffledVideos[currentIndex].id);
  renderList();
}

function playNext() {
  if (++currentIndex >= shuffledVideos.length) return;
  loadCurrent();
}

function playPrevious() {
  if (--currentIndex < 0) currentIndex = 0;
  loadCurrent();
}

function togglePlay() {
  if (isPlaying) {
    player.pauseVideo();
  } else {
    player.playVideo();
  }
  isPlaying = !isPlaying;
}

function renderList() {
  const list = document.getElementById("list-section");
  list.innerHTML = "";

  for (let i = currentIndex; i < Math.min(currentIndex + 15, shuffledVideos.length); i++) {
    const v = shuffledVideos[i];
    const div = document.createElement("div");
    div.className = "video-item" + (i === currentIndex ? " active" : "");
    div.onclick = () => {
      currentIndex = i;
      loadCurrent();
    };

    div.innerHTML = `
      <img src="${v.thumbnail}">
      <div class="video-title">${v.title}</div>
    `;
    list.appendChild(div);
  }
}

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    events: {
      onReady: () => {
        player.setVolume(globalVolume);
        document.getElementById("volumeSlider").value = globalVolume;
      },
      onStateChange: e => {
        if (e.data === YT.PlayerState.ENDED) playNext();
      },
      onError: () => {
        if (skipInProgress) return;
        skipInProgress = true;
        playNext();
        skipInProgress = false;
      }
    }
  });
}

document.getElementById("volumeSlider").oninput = e => {
  globalVolume = e.target.value;
  localStorage.setItem("ytVolume", globalVolume);
  if (player) player.setVolume(globalVolume);
};

window.onload = loadVideos;
</script>

</body>
</html>
